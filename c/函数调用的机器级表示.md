---
tags: 
created_date: 2024-01-21 17:55
modified_date: ' 2024-01-21 17:55:53'
review_date: 
pomodoro_time: 
used_time: 
aliases:
---
本周的主要内容是介绍高级语言程序的机器级表示，也就是对应的指令序列。我们选用的指令系统是IA-32指令系统，所以上一周我们先介绍了IA-32指令系统，讲解了IA-32的各种常用指令的功能。在此基础上，本周将介绍基于IA-32的机器级表示。

下面开始第一讲：过程调用的机器级表示。本讲主要介绍C语言程序中过程调用，也就是函数调用对应的机器级表示。包括

- [ ] 如何传递参数?
- [ ] 如何将控制转移到被调用过程?
- [ ] 寄存器使用约定?
- [ ] 递归函数的实现?

1.  add过程调用它对应的指令序列应该是什么？
2. t1、t2，也就是125、80，这两个实参如何传递给add这个函数当中的x、y这两个形参的?
3. 执行的结果是如何返回给这个调用过程的?
![[Pasted image 20240121180104.png|925]]

这里的main就是调用函数，这里的add就是被调用函数。也就是说，在这个过程当中，实际上main里面有一串指令序列是用来传递参数的。有一条指令呢是用来控制执行的顺序，从main转移到add，然后在add这个里面呢有指令要取出参数，然后一串指令来执行过程体。还要有返回结果，使得main能够取到这个结果，最后返回main。在这个里面，调出add执行的这条指令，它的目的地是add这个函数的首地址。所以这个地方我们可以猜到是用call指令实现的。call指令，我们前面讲过，它实际上是会把这个返回地址，也就是call指令下一条指-令的地址会放到栈里面，这样的话在add函数最后执行return指令的时候，它可以从栈里面取出这个返回地址
使得它能够正确的返回到main执行。

我们可以看到参数的传递，因为参数有可能比如说是两个，三个四个，有可能很多，这些参数一定是要放到一个存储空间当中去。这个存储空间就是

栈，stack。这个栈显然在一个存储空间当中。可执行文件实际上它装入的时候是映射到一个存储空间里面去的，比如说这些代码和数据都是放在不同的存储段里面，一块存储区域里面

栈呢，是整个这个存储空间当中的一块区域，这块区域通常是在高地址当中，这个是个用户栈。整个的这个**地址空间**分成**操作系统的内核区**和**用户进程的用户区**。

在这个用户区当中，**最高的地址部分就是栈区**。**栈区它的栈底是一个确定的高地址，从高地址向低地址增长**。也就是说我们往栈里面送东西，就**压栈的时候，是往低地址长的**，**出栈的时候再往高地址退**，因此这个栈有一个栈顶，这个栈顶的地址是放在专门的一个寄存器里面，叫**栈指针寄存器**，IA-32里面的栈指针寄存器是ESP。


![[Pasted image 20240121180212.png|650]]



在函数过程当中，第一步是存放参数，P把这个入口参数放到Q能访问到的地方，也就是放到栈里面，然后呢执行一个call指令，这个call指令会把返回地址压栈，然后转移到被调用过程去执行。然后在被调用过程当中第一件事情要**保存**P里面的**现场***，*P的现场实际上就是P里面用到的通用寄存器的内容*。


![[Pasted image 20240121180344.png|800]]

![[Pasted image 20240121180423.png|775]]





![[Pasted image 20240121180630.png]]



![[Pasted image 20240121180814.png]]

